{% extends 'boarding/base.html' %}
{% block title %}My Onboarding ‚Äì OnBoardHub{% endblock %}

{% block content %}
<!-- Welcome Banner -->
<div class="card mb-4" style="background:linear-gradient(135deg,#1a56db,#3b82f6);border-radius:14px;border:none;">
    <div class="card-body p-4 text-white">
        <div class="row align-items-center">
            <div class="col">
                <h4 class="fw-bold mb-1">Welcome, {{ candidate.full_name }}! üëã</h4>
                <p class="mb-3" style="opacity:0.85;font-size:0.875rem;">
                    {{ candidate.position }} &bull; {{ candidate.department }}
                    {% if candidate.joining_date %}&bull; Joining: {{ candidate.joining_date }}{% endif %}
                </p>
                <div>
                    <div class="d-flex justify-content-between mb-1">
                        <small>Onboarding Progress</small>
                        <small><strong>{{ done }}/{{ total }} documents</strong></small>
                    </div>
                    <div class="progress" style="height:10px;background:rgba(255,255,255,0.25);">
                        <div class="progress-bar bg-white" style="width:{{ progress }}%;"></div>
                    </div>
                </div>
            </div>
            <div class="col-auto d-none d-md-block">
                <div style="font-size:4rem;opacity:0.2;"><i class="bi bi-file-earmark-check"></i></div>
            </div>
        </div>
    </div>
</div>

<!-- Instructions -->
{% if done < total %}
<div class="alert" style="background:#eff6ff;border:1px solid #bfdbfe;color:#1e40af;font-size:0.875rem;">
    <i class="bi bi-info-circle me-2"></i>
    Please upload all required documents below. Accepted formats: <strong>PDF, JPG, PNG</strong>. Max file size: 5MB per file.
</div>
{% else %}
<div class="alert" style="background:#f0fdf4;border:1px solid #bbf7d0;color:#065f46;font-size:0.875rem;">
    <i class="bi bi-check-circle me-2"></i>
    <strong>All documents submitted!</strong> Our HR team is reviewing them. You'll be notified of any issues.
</div>
{% endif %}

<!-- Documents Grid -->
<div class="row g-3">
{% for item in doc_list %}
<div class="col-md-6 col-lg-4">
    <div class="doc-card {% if item.doc %}{% if item.doc.status == 'rejected' %}rejected{% else %}uploaded{% endif %}{% endif %}">
        <div class="d-flex align-items-start gap-3">
            <div class="doc-icon">
                {% if item.key == 'aadhaar' %}ü™™
                {% elif item.key == 'pan' %}üí≥
                {% elif item.key == 'photo' %}üì∑
                {% elif item.key == 'resume' %}üìÑ
                {% elif item.key == 'marksheet' %}üìã
                {% elif item.key == 'degree' %}üéì
                {% elif item.key == 'bank' %}üè¶
                {% endif %}
            </div>
            <div class="flex-grow-1">
                <div class="doc-title">{{ item.label }}</div>

                {% if item.doc %}
                    <div class="mt-1">
                        <span class="status-badge badge-{{ item.doc.status }} doc-status">
                            {% if item.doc.status == 'approved' %}<i class="bi bi-check me-1"></i>Approved
                            {% elif item.doc.status == 'rejected' %}<i class="bi bi-x me-1"></i>Rejected
                            {% else %}<i class="bi bi-clock me-1"></i>Under Review
                            {% endif %}
                        </span>
                    </div>
                    {% if item.doc.hr_remarks %}
                    <div class="mt-1 p-2 rounded" style="background:#fee2e2;font-size:0.75rem;color:#991b1b;">
                        <i class="bi bi-chat-square-text me-1"></i>{{ item.doc.hr_remarks }}
                    </div>
                    {% endif %}
                    <div class="mt-2 d-flex gap-1">
                        <a href="{{ item.doc.file.url }}" target="_blank" class="btn btn-sm" style="background:#f1f5f9;border:1px solid #e2e8f0;color:#374151;font-size:0.75rem;">
                            <i class="bi bi-eye me-1"></i>View
                        </a>
                        {% if item.doc.status != 'approved' %}
                        <button class="btn btn-sm btn-primary" style="font-size:0.75rem;" 
                                data-bs-toggle="modal" data-bs-target="#uploadModal{{ item.key }}">
                            <i class="bi bi-arrow-repeat me-1"></i>Replace
                        </button>
                        {% endif %}
                    </div>
                {% else %}
                    <div class="mt-1" style="font-size:0.78rem;color:#94a3b8;">Not uploaded yet</div>
                    <button class="btn btn-sm btn-primary mt-2" style="font-size:0.78rem;"
                            data-bs-toggle="modal" data-bs-target="#uploadModal{{ item.key }}">
                        <i class="bi bi-upload me-1"></i>Upload
                    </button>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Upload Modal for each doc type -->
<div class="modal fade" id="uploadModal{{ item.key }}" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius:14px;border:none;">
            <div class="modal-header" style="border-bottom:1px solid #e2e8f0;">
                <h6 class="modal-title fw-bold">Upload {{ item.label }}</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{% url 'upload_document' %}" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="doc_type" value="{{ item.key }}">
                <div class="modal-body">
                    <div class="mb-3 p-3 rounded text-center" style="background:#f8fafc;border:2px dashed #cbd5e1;">
                        <i class="bi bi-cloud-upload" style="font-size:2rem;color:#94a3b8;"></i>
                        <p class="mb-2 mt-1" style="font-size:0.85rem;color:#64748b;">Select file to upload</p>
                        <input type="file" name="file" class="form-control" accept=".pdf,.jpg,.jpeg,.png" required
                               style="font-size:0.85rem;">
                    </div>
                    <div style="font-size:0.78rem;color:#94a3b8;">
                        <i class="bi bi-info-circle me-1"></i>
                        Accepted: PDF, JPG, PNG &bull; Max size: 5MB
                        {% if item.doc %}&bull; This will replace your current file.{% endif %}
                    </div>
                </div>
                <div class="modal-footer" style="border-top:1px solid #e2e8f0;">
                    <button type="button" class="btn" data-bs-dismiss="modal" style="background:#f1f5f9;border:1px solid #e2e8f0;">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-upload me-2"></i>Upload Document
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}
</div>
{% endblock %}